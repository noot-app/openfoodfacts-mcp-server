#!/usr/bin/env bash

set -euo pipefail

source script/env "$@"

# Load deploy environment variables if they exist
if [[ -f ".deploy.env" ]]; then
  set -a
  source .deploy.env
  set +a
fi
    
# Check required environment variable
if [[ -z "${RAILWAY_TOKEN:-}" ]]; then
  echo "Error: RAILWAY_TOKEN must be set"
  exit 1
fi
    
# Build railway command with optional --ci flag
railway_args=("up" "--service" "openfoodfacts-mcp-server")
if [[ "${2:-}" == "--ci" ]]; then
  railway_args+=("--ci")
fi

railway "${railway_args[@]}"
